<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <div class="topbar">
  <h1>Gestor de Consumo â€” Pro</h1>
  <div style="display:flex;align-items:center;gap:10px;">
    <div id="server-indicator" style="width:12px;height:12px;border-radius:50%;background:#ccc;"></div>
    <span id="server-label">Desconectado</span>
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ Tema</button>
  </div>
</div>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestor de Consumo â€” Pro</title>
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg" />
  <meta name="theme-color" content="#1e88e5"/>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

  <!-- Indicador de servidor -->
  <div class="conn-indicator">
    <span id="server-indicator" class="dot"></span>
    <span id="server-label">Checandoâ€¦</span>
  </div>

  <!-- Login -->
  <section id="login-section" class="auth">
    <div class="auth-card">
      <h1>Gestor de Consumo</h1>
      <p class="subtitle">Acesse seu painel</p>

      <div id="checking" class="msg">ğŸ”„ Checando servidorâ€¦</div>

      <div id="auth" style="display:none">
        <div class="field">
          <label>E-mail</label>
          <input type="email" id="email" placeholder="thiago@teste.com" />
        </div>
        <div class="field">
          <label>Senha</label>
          <input type="password" id="password" placeholder="123456" />
        </div>
        <button onclick="login()">Entrar</button>
        <div id="login-msg" class="msg"></div>
      </div>
    </div>
  </section>

  <!-- App -->
  <div id="dashboard" class="app" style="display:none">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">GC</div>
        <div class="brand-text">
          <strong>Gestor Pro</strong>
          <span id="user-name">â€”</span>
        </div>
      </div>
      <nav>
        <button class="nav-btn active" onclick="showSection('section-dashboard')">ğŸ“Š Dashboard</button>
        <button class="nav-btn" onclick="showSection('section-meters')">ğŸ§­ Medidores</button>
        <button class="nav-btn" onclick="showSection('section-readings')">ğŸ“ˆ Leituras</button>
        <button class="nav-btn" onclick="showSection('section-goals')">ğŸ¯ Metas</button>
        <button class="nav-btn" onclick="showSection('section-users')">ğŸ‘¥ UsuÃ¡rios</button>
      </nav>
      <div style="margin-top:auto;display:flex;gap:8px;">
        <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ Tema</button>
        <button class="theme-toggle" onclick="logout()">ğŸšª Sair</button>
      </div>
    </aside>

    <main class="main">
      <!-- DASHBOARD -->
      <section id="section-dashboard" class="content-section">
        <h2>VisÃ£o Geral</h2>
        <div class="cards">
          <div class="card"><div>Total Leituras</div><strong id="card-readings">â€”</strong></div>
          <div class="card"><div>Ãgua (L)</div><strong id="card-water">â€”</strong></div>
          <div class="card"><div>Energia (kWh)</div><strong id="card-energy">â€”</strong></div>
          <div class="card"><div>Alertas hoje</div><strong id="card-alerts">â€”</strong></div>
        </div>
        <canvas id="chart" height="100"></canvas>
        <ul id="alerts" class="alert-list" style="margin-top:12px;display:grid;gap:8px;"></ul>
      </section>

      <!-- MEDIDORES -->
      <section id="section-meters" class="content-section" style="display:none">
        <h2>Medidores</h2>
        <div class="cards">
          <div class="card" style="grid-column:1/-1">
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <input id="meter-name" placeholder="Nome (ex: Ap 301 - Luz)"/>
              <select id="meter-type">
                <option value="agua">Ãgua</option>
                <option value="energia">Energia</option>
              </select>
              <input id="meter-location" placeholder="Local/Bloco (opcional)"/>
              <button class="theme-toggle" onclick="addMeter()">Adicionar</button>
              <button class="theme-toggle" onclick="loadMeters()">Atualizar</button>
            </div>
          </div>
        </div>
        <table class="table">
          <thead><tr><th>ID</th><th>Nome</th><th>Tipo</th><th>Local</th><th>AÃ§Ãµes</th></tr></thead>
          <tbody id="meter-list"></tbody>
        </table>
      </section>

      <!-- LEITURAS -->
      <section id="section-readings" class="content-section" style="display:none">
        <h2>Leituras</h2>
        <div class="cards">
          <div class="card">Filtros rÃ¡pidos:
            <div style="display:flex;gap:8px;margin-top:6px;">
              <button class="theme-toggle" onclick="reloadReadings()">Atualizar</button>
              <button class="theme-toggle" onclick="exportExcel()">Exportar Excel</button>
            </div>
          </div>
        </div>
        <table class="table">
          <thead><tr><th>ID</th><th>Medidor</th><th>Tipo</th><th>Valor</th><th>Data</th></tr></thead>
          <tbody id="readings-table"></tbody>
        </table>
      </section>

      <!-- METAS -->
      <section id="section-goals" class="content-section" style="display:none">
        <h2>Metas por Medidor</h2>
        <div class="cards">
          <div class="card" style="grid-column:1/-1">
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <input id="goal-meter-id" placeholder="ID do medidor (ou 'agua'/'energia')" />
              <input id="goal-meter-name" placeholder="Nome do medidor"/>
              <input id="goal-daily" type="number" step="0.01" placeholder="Meta diÃ¡ria"/>
              <input id="goal-warn" type="number" placeholder="% aviso (ex: 80)"/>
              <button class="theme-toggle" onclick="saveGoal()">Salvar meta</button>
              <button class="theme-toggle" onclick="deleteGoal()">Remover meta</button>
              <button class="theme-toggle" onclick="loadGoals()">Atualizar</button>
            </div>
          </div>
        </div>
        <table class="table">
          <thead><tr><th>Meter ID</th><th>Nome</th><th>Meta diÃ¡ria</th><th>Warn %</th></tr></thead>
          <tbody id="goals-table"></tbody>
        </table>
      </section>

      <!-- USUÃRIOS -->
      <section id="section-users" class="content-section" style="display:none">
        <h2>UsuÃ¡rios</h2>
        <div class="cards">
          <div class="card" style="grid-column:1/-1">
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <input id="user-name" placeholder="Nome"/>
              <input id="user-email" placeholder="E-mail"/>
              <input id="user-password" placeholder="Senha"/>
              <select id="user-role"><option value="user">UsuÃ¡rio</option><option value="admin">Admin</option></select>
              <button class="theme-toggle" onclick="createUser()">Adicionar</button>
              <button class="theme-toggle" onclick="loadUsers()">Atualizar</button>
            </div>
          </div>
        </div>
        <table class="table">
          <thead><tr><th>ID</th><th>Nome</th><th>E-mail</th><th>Role</th><th>Criado</th><th>AÃ§Ãµes</th></tr></thead>
          <tbody id="users-table"></tbody>
        </table>
      </section>

    </main>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
