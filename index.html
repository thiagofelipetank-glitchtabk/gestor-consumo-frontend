<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestor de Consumo â€” Pro</title>
  <link rel="icon" href="assets/favicon.svg" />
  <link rel="stylesheet" href="style.css" />

  <!-- libs do frontend -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <!-- indicador topo -->
  <div class="top-indicator">
    <span id="server-indicator" class="dot red"></span>
    <span id="server-label" class="muted">Checandoâ€¦</span>
    <button onclick="toggleTheme()" class="theme-toggle">ğŸŒ“ Tema</button>
  </div>

  <!-- tela de checagem -->
  <section id="checking" class="auth">
    <div class="auth-card">
      <h1>Gestor de Consumo</h1>
      <p class="subtitle">Acesse seu painel</p>
      <div class="msg" id="server-status">Checandoâ€¦</div>
    </div>
  </section>

  <!-- login -->
  <section id="auth" class="auth" style="display:none;">
    <div class="auth-card">
      <h1>Gestor de Consumo</h1>
      <p class="subtitle">Acesse seu painel</p>

      <div class="field">
        <label>E-mail</label>
        <input type="email" id="email" placeholder="" autocomplete="username" />
      </div>
      <div class="field">
        <label>Senha</label>
        <input type="password" id="password" placeholder="" autocomplete="current-password" />
      </div>
      <button onclick="login()">Entrar</button>
      <div class="msg" id="login-msg"></div>
    </div>
  </section>

  <!-- app -->
  <div id="app" class="app" style="display:none;">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">GC</div>
        <div class="brand-text">
          <strong>Gestor Pro</strong>
          <span id="user-name">â€”</span>
          <span id="user-role" class="role-badge">â€”</span>
        </div>
      </div>
      <nav>
        <button class="nav-btn active" onclick="showSection('dashboard')">ğŸ“Š Dashboard</button>
        <button class="nav-btn" onclick="showSection('meters')">ğŸ§­ Medidores</button>
        <button class="nav-btn" onclick="showSection('readings')">ğŸ“ˆ Leituras</button>
        <button class="nav-btn" onclick="showSection('properties')">ğŸ  ImÃ³veis</button>
        <button class="nav-btn" onclick="showSection('finance')">ğŸ’¼ Financeiro</button>
        <button class="nav-btn" onclick="showSection('goals')">ğŸ¯ Metas</button>
        <button class="nav-btn" onclick="showSection('users')">ğŸ‘¥ UsuÃ¡rios</button>
        <button class="nav-btn" onclick="logout()">ğŸšª Sair</button>
      </nav>
    </aside>

    <main class="main">
      <!-- DASHBOARD -->
      <section id="section-dashboard">
        <div class="topbar"><h2>Dashboard</h2></div>

        <div class="cards quick-cards">
          <div class="card"><div>Total Leituras</div><div id="card-readings" class="big">â€”</div></div>
          <div class="card"><div>Ãgua (L)</div><div id="card-water" class="big">â€”</div></div>
          <div class="card"><div>Energia (kWh)</div><div id="card-energy" class="big">â€”</div></div>
        </div>

        <div class="card">
          <div class="tabs">
            <button id="tab-agua" class="tab active" onclick="setDashTab('agua')">Ãgua</button>
            <button id="tab-energia" class="tab" onclick="setDashTab('energia')">Energia</button>
            <div class="tab-spacer"></div>
            <select id="dash-range" onchange="loadDashboard()">
              <option value="1">Hoje</option>
              <option value="7" selected>Ãšltimos 7 dias</option>
              <option value="30">Ãšltimos 30 dias</option>
            </select>
          </div>
          <canvas id="chart-main" height="140"></canvas>
        </div>

        <div class="cards">
          <div class="card">
            <h3>Comparativo DiÃ¡rio (7 dias)</h3>
            <canvas id="chart-daily" height="120"></canvas>
          </div>
          <div class="card">
            <h3>Comparativo Mensal (6 meses)</h3>
            <canvas id="chart-monthly" height="120"></canvas>
          </div>
        </div>

        <div class="card">
          <h3>Alertas de Meta</h3>
          <ul id="alerts" class="alert-list"></ul>
        </div>
      </section>

      <!-- MEDIDORES -->
      <section id="section-meters" style="display:none;">
        <h2>Medidores</h2>
        <div id="admin-meters-create" class="card create-row" style="display:none;">
          <input id="meter-name" placeholder="Nome do medidor" />
          <select id="meter-type">
            <option value="agua">Ãgua</option>
            <option value="energia">Energia</option>
          </select>
          <button class="theme-toggle" onclick="addMeter()">Adicionar</button>
          <button class="theme-toggle" onclick="loadMeters()">Atualizar</button>
        </div>

        <div class="card">
          <ul id="meter-list" class="meter-list"></ul>
        </div>
      </section>

      <!-- LEITURAS -->
      <section id="section-readings" style="display:none;">
        <h2>Leituras</h2>
        <div class="card filters">
          <div>
            <label>Tipo</label><br/>
            <select id="filter-type">
              <option value="">Todos</option>
              <option value="agua">Ãgua</option>
              <option value="energia">Energia</option>
            </select>
          </div>
          <div><label>De</label><br/><input type="date" id="date-from"></div>
          <div><label>AtÃ©</label><br/><input type="date" id="date-to"></div>
          <button class="theme-toggle" onclick="applyReadingsFilter()">Aplicar</button>
          <button class="theme-toggle" onclick="clearReadingsFilter()">Limpar</button>
          <button class="theme-toggle" onclick="exportToExcel()">ğŸ“¦ Excel</button>
          <button class="theme-toggle" onclick="exportPDF()">ğŸ§¾ PDF</button>
        </div>
        <div class="card">
          <table class="table" id="readings-table">
            <thead><tr><th>ID</th><th>Medidor</th><th>Tipo</th><th>Valor</th><th>Data</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- IMÃ“VEIS -->
      <section id="section-properties" style="display:none;">
        <h2>ImÃ³veis</h2>
        <div id="admin-props-create" class="card create-row" style="display:none;">
          <div><label>Nome do ImÃ³vel</label><br/><input id="prop-name" placeholder="Ex.: Kitnet 01" /></div>
          <div><label>EndereÃ§o</label><br/><input id="prop-address" placeholder="Rua, nÂº, bairro" /></div>
          <div><label>ResponsÃ¡vel</label><br/><input id="prop-owner" placeholder="Nome do responsÃ¡vel" /></div>
          <button class="theme-toggle" onclick="createProperty()">Cadastrar</button>
          <button class="theme-toggle" onclick="loadProperties()">Atualizar</button>
        </div>
        <div class="card">
          <table class="table" id="properties-table">
            <thead><tr><th>ID</th><th>Nome</th><th>EndereÃ§o</th><th>ResponsÃ¡vel</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- FINANCEIRO (tarifas locais) -->
      <section id="section-finance" style="display:none;">
        <h2>Financeiro</h2>
        <div class="card create-row">
          <div>
            <label>Tarifa Ãgua (R$/mÂ³)</label><br/>
            <input id="tar-agua" type="number" step="0.0001" placeholder="0.00" />
          </div>
          <div>
            <label>Tarifa Energia (R$/kWh)</label><br/>
            <input id="tar-energia" type="number" step="0.0001" placeholder="0.00" />
          </div>
          <button class="theme-toggle" onclick="saveTarifas()">Salvar tarifas</button>
          <span class="muted">* Salvo neste navegador por enquanto.</span>
        </div>
        <div class="card">
          <p class="muted">As tarifas acima sÃ£o usadas para estimar custo nas telas/relatÃ³rios. Em prÃ³xima etapa podemos salvar no backend.</p>
        </div>
      </section>

      <!-- METAS -->
      <section id="section-goals" style="display:none;">
        <h2>Metas</h2>
        <div class="card create-row">
          <select id="goal-meter"></select>
          <input type="number" id="goal-daily" placeholder="Meta diÃ¡ria" min="0" step="0.01"/>
          <input type="number" id="goal-warn" placeholder="% aviso (ex: 90)" min="1" max="99"/>
          <button class="theme-toggle" onclick="saveGoal()">Salvar</button>
          <button class="theme-toggle" onclick="deleteGoal()">Remover</button>
        </div>
        <div class="card"><ul id="alerts-goals" class="alert-list"></ul></div>
      </section>

      <!-- USUÃRIOS (admin) -->
      <section id="section-users" style="display:none;">
        <h2>UsuÃ¡rios (Admin)</h2>

        <div id="admin-users-create" class="card create-row" style="display:none;">
          <input id="userCreate-name" placeholder="Nome" />
          <input id="userCreate-email" placeholder="E-mail" />
          <input id="userCreate-password" placeholder="Senha" />
          <select id="userCreate-role">
            <option value="user">UsuÃ¡rio</option>
            <option value="admin">Admin</option>
          </select>
          <div id="userCreate-meters" class="checkbox-grid"></div>
          <button class="theme-toggle" onclick="createUser()">Adicionar</button>
          <button class="theme-toggle" onclick="loadUsers()">Atualizar</button>
        </div>

        <div class="card">
          <table class="table" id="users-table">
            <thead><tr><th>ID</th><th>Nome</th><th>E-mail</th><th>FunÃ§Ã£o</th><th>Medidores</th><th>AÃ§Ãµes</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
