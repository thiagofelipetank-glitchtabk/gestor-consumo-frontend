<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gestor de Consumo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <header>
    <h1>Gestor de Consumo</h1>
    <div class="actions"><button id="logout-btn">Sair</button></div>
  </header>

  <!-- LOGIN -->
  <section id="login-section">
    <h2>Acesse sua conta</h2>
    <div class="field">
      <label for="email">E-mail</label>
      <input id="email" type="email" placeholder="Digite seu e-mail" autocomplete="username" />
    </div>
    <div class="field">
      <label for="password">Senha</label>
      <input id="password" type="password" placeholder="Digite sua senha" autocomplete="current-password" />
    </div>
    <button id="login-btn" class="btn">Entrar</button>
    <div id="login-msg" class="msg"></div>
  </section>

  <!-- APP -->
  <div id="app" class="container">
    <nav>
      <button class="nav-btn active" data-target="dashboard">Dashboard</button>
      <button class="nav-btn" data-target="agua">Água</button>
      <button class="nav-btn" data-target="energia">Energia</button>
      <button class="nav-btn" data-target="config">Configurações</button>
      <button id="nav-users" class="nav-btn" data-target="usuarios" style="display:none">Usuários</button>
      <button id="nav-meters" class="nav-btn" data-target="medidores" style="display:none">Medidores</button>
      <button id="nav-3f" class="nav-btn" data-target="trifasico" style="display:none">Trifásico</button>
    </nav>

    <main>
      <!-- Dashboard -->
      <section id="dashboard" class="section active">
        <h2>Resumo do mês (por medidor)</h2>
        <div class="row">
          <label>Mês:</label>
          <input id="month-input" type="month" />
          <button id="refresh-month">Atualizar</button>
        </div>
        <div id="dashboard-cards" class="cards mt"></div>
      </section>

      <!-- Água -->
      <section id="agua" class="section">
        <h2>Água</h2>
        <div class="row">
          <label>Medidor:</label>
          <select id="agua-meter"></select>
          <label>Dias:</label>
          <input id="agua-range" type="number" min="1" max="60" value="7" />
          <button id="agua-apply">Aplicar</button>
        </div>
        <div class="cards mt">
          <div class="card"><h3>Total</h3><p id="agua-total">0 m³</p></div>
          <div class="card"><h3>Custo</h3><p id="agua-cost">R$ 0,00</p></div>
        </div>
        <canvas id="agua-chart" class="mt"></canvas>
      </section>

      <!-- Energia -->
      <section id="energia" class="section">
        <h2>Energia</h2>
        <div class="row">
          <label>Medidor:</label>
          <select id="energia-meter"></select>
          <label>Dias:</label>
          <input id="energia-range" type="number" min="1" max="60" value="7" />
          <button id="energia-apply">Aplicar</button>
        </div>
        <div class="cards mt">
          <div class="card"><h3>Total</h3><p id="energia-total">0 kWh</p></div>
          <div class="card"><h3>Custo</h3><p id="energia-cost">R$ 0,00</p></div>
        </div>
        <canvas id="energia-chart" class="mt"></canvas>
      </section>

      <!-- Config -->
      <section id="config" class="section">
        <h2>Configurações</h2>
        <div class="row">
          <div class="card">
            <h3>Tarifas</h3>
            <div class="row">
              <label>kWh (R$)</label>
              <input id="kwh-price" type="number" step="0.01" min="0" />
              <label>m³ (R$)</label>
              <input id="m3-price" type="number" step="0.01" min="0" />
              <button id="save-tariffs">Salvar</button>
            </div>
            <p id="tariff-msg" class="mt"></p>
          </div>
        </div>
      </section>

      <!-- Usuários -->
      <section id="usuarios" class="section">
        <h2>Usuários</h2>
        <div class="card">
          <h3>Novo usuário</h3>
          <div class="row">
            <input id="u-name" type="text" placeholder="Nome" />
            <input id="u-email" type="email" placeholder="E-mail" />
            <input id="u-pass" type="password" placeholder="Senha" />
            <select id="u-role">
              <option value="user">user</option>
              <option value="admin">admin</option>
            </select>
            <button id="u-create">Criar</button>
          </div>
          <p id="u-msg" class="mt"></p>
        </div>

        <div class="card mt">
          <div class="row">
            <input id="perm-filter" type="text" placeholder="Filtrar medidores por nome..." />
          </div>
          <h3>Lista</h3>
          <table>
            <thead>
              <tr>
                <th>#</th><th>Nome</th><th>Email</th><th>Perfil</th><th>Permissões</th><th>Ações</th>
              </tr>
            </thead>
            <tbody id="u-tbody"></tbody>
          </table>
        </div>
      </section>

      <!-- Medidores -->
      <section id="medidores" class="section">
        <h2>Medidores</h2>
        <div class="card">
          <h3>Novo medidor</h3>
          <div class="row">
            <input id="m-name" type="text" placeholder="Nome do medidor" />
            <select id="m-type">
              <option value="agua">água</option>
              <option value="energia">energia</option>
              <option value="energia-3f">energia-3f (trifásico)</option>
            </select>
            <button id="m-create">Criar</button>
          </div>
          <p class="small">Para trifásico, o token é único do equipamento IE e o app divide por fase.</p>
          <p id="m-msg" class="mt"></p>
        </div>

        <div class="card mt">
          <h3>Lista</h3>
          <table>
            <thead>
              <tr>
                <th>#</th><th>Nome</th><th>Tipo</th><th>Token</th><th>Criado</th><th>Ações</th>
              </tr>
            </thead>
            <tbody id="m-tbody"></tbody>
          </table>
        </div>
      </section>

      <!-- Trifásico -->
      <section id="trifasico" class="section">
        <h2>Mapeamento Trifásico (A/B/C → Apartamentos)</h2>
        <div class="card">
          <div class="row">
            <label>Medidor 3F:</label>
            <select id="map-parent"></select>
            <button id="map-autocreate">Autocriar Fases A/B/C</button>
          </div>
          <div id="map-editor" class="mt"></div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Altere aqui para sua URL do backend na Render
    window.APP_CONFIG = {
      API_URL: "https://gestor-consumo-backend.onrender.com"
    };
  </script>
  <script src="./renderer.js"></script>
</body>
</html>
