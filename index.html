<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestor de Consumo ‚Äî Pro</title>
  <link rel="icon" href="assets/favicon.svg" />
  <link rel="stylesheet" href="style.css" />

  <!-- libs do frontend -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <!-- indicador topo -->
  <div style="display:flex;gap:10px;align-items:center;justify-content:center;padding:8px 12px;">
    <span id="server-indicator" style="width:10px;height:10px;border-radius:999px;background:#ef4444;"></span>
    <span id="server-label" style="font-size:14px;color:#94a3b8;">Checando‚Ä¶</span>
    <button onclick="toggleTheme()" class="theme-toggle">üåì Tema</button>
  </div>

  <!-- tela de checagem -->
  <section id="checking" class="auth">
    <div class="auth-card">
      <h1>Gestor de Consumo</h1>
      <p class="subtitle">Acesse seu painel</p>
      <div class="msg" id="server-status">Checando‚Ä¶</div>
    </div>
  </section>

  <!-- login -->
  <section id="auth" class="auth" style="display:none;">
    <div class="auth-card">
      <h1>Gestor de Consumo</h1>
      <p class="subtitle">Acesse seu painel</p>

      <div class="field">
        <label>E-mail</label>
        <input type="email" id="email" placeholder="thiago@teste.com" />
      </div>
      <div class="field">
        <label>Senha</label>
        <input type="password" id="password" placeholder="123456" />
      </div>
      <button onclick="login()">Entrar</button>
      <div class="msg" id="login-msg"></div>
    </div>
  </section>

  <!-- app -->
  <div id="app" class="app" style="display:none;">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">GC</div>
        <div class="brand-text">
          <strong>Gestor Pro</strong>
          <span id="user-name">‚Äî</span>
        </div>
      </div>
      <nav>
        <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
        <button class="nav-btn" onclick="showSection('meters')">üß≠ Medidores</button>
        <button class="nav-btn" onclick="showSection('readings')">üìà Leituras</button>
        <button class="nav-btn" onclick="showSection('properties')">üè† Im√≥veis</button>
        <button class="nav-btn" onclick="showSection('finance')">üíº Financeiro</button>
        <button class="nav-btn" onclick="showSection('goals')">üéØ Metas</button>
        <button class="nav-btn" onclick="showSection('reports')">üìã Relat√≥rios</button>
        <button class="nav-btn" onclick="showSection('users')">üë• Usu√°rios</button>
        <button class="nav-btn" onclick="showSection('history')">üóÇÔ∏è Hist√≥rico</button>
        <button class="nav-btn" onclick="logout()">üö™ Sair</button>
      </nav>
    </aside>

    <main class="main">
      <!-- DASHBOARD -->
      <section id="section-dashboard">
        <div class="topbar"><h2>Dashboard</h2></div>
        <div class="cards">
          <div class="card"><div>Leituras</div><div id="card-readings" style="font-size:28px;font-weight:700;">‚Äî</div></div>
          <div class="card"><div>√Ågua (L)</div><div id="card-water" style="font-size:28px;font-weight:700;">‚Äî</div></div>
          <div class="card"><div>Energia (kWh)</div><div id="card-energy" style="font-size:28px;font-weight:700;">‚Äî</div></div>
        </div>
        <div class="card"><h3>Comparativo Di√°rio (√∫ltimos 7 dias)</h3><canvas id="chart-daily" height="120"></canvas></div>
        <div class="card"><h3>Comparativo Mensal (√∫ltimos 6 meses)</h3><canvas id="chart-monthly" height="120"></canvas></div>
        <div class="card"><h3>Alertas</h3><ul id="alerts" class="alert-list" style="display:grid;gap:8px;"></ul></div>
      </section>

      <!-- MEDIDORES -->
      <section id="section-meters" style="display:none;">
        <h2>Medidores</h2>
        <div class="cards">
          <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;">
            <input id="meter-name" placeholder="Nome do medidor" />
            <select id="meter-type">
              <option value="agua">√Ågua</option>
              <option value="energia">Energia</option>
            </select>
            <button class="theme-toggle" onclick="addMeter()">Adicionar</button>
            <button class="theme-toggle" onclick="loadMeters()">Atualizar</button>
          </div>
          <div class="card" style="grid-column:1/-1;">
            <ul id="meter-list" style="display:grid;gap:8px;"></ul>
          </div>
        </div>
      </section>

      <!-- LEITURAS -->
      <section id="section-readings" style="display:none;">
        <h2>Leituras</h2>
        <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end;">
          <div><label>Tipo</label><br/>
            <select id="filter-type"><option value="">Todos</option><option value="agua">√Ågua</option><option value="energia">Energia</option></select>
          </div>
          <div><label>De</label><br/><input type="date" id="date-from"></div>
          <div><label>At√©</label><br/><input type="date" id="date-to"></div>
          <button class="theme-toggle" onclick="applyReadingsFilter()">Aplicar</button>
          <button class="theme-toggle" onclick="clearReadingsFilter()">Limpar</button>
          <button class="theme-toggle" onclick="exportToExcel()">üì¶ Excel</button>
          <button class="theme-toggle" onclick="exportPDF()">üßæ PDF</button>
        </div>
        <div class="card">
          <table class="table" id="readings-table">
            <thead><tr><th>ID</th><th>Medidor</th><th>Tipo</th><th>Valor</th><th>Data</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- IM√ìVEIS -->
      <section id="section-properties" style="display:none;">
        <h2>Im√≥veis</h2>
        <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end;">
          <div><label>Nome do Im√≥vel</label><br/><input id="prop-name" placeholder="Ex.: Kitnet 01" /></div>
          <div><label>Endere√ßo</label><br/><input id="prop-address" placeholder="Rua, n¬∫, bairro" /></div>
          <div><label>Respons√°vel</label><br/><input id="prop-owner" placeholder="Nome do respons√°vel" /></div>
          <button class="theme-toggle" onclick="createProperty()">Cadastrar</button>
          <button class="theme-toggle" onclick="loadProperties()">Atualizar</button>
        </div>
        <div class="card">
          <table class="table" id="properties-table">
            <thead><tr><th>ID</th><th>Nome</th><th>Endere√ßo</th><th>Respons√°vel</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- FINANCEIRO -->
      <section id="section-finance" style="display:none;">
        <h2>Financeiro</h2>
        <div class="cards">
          <!-- Funcion√°rios -->
          <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end;">
            <div><label>Nome</label><br/><input id="emp-name" placeholder="Nome do funcion√°rio" /></div>
            <div><label>Cargo</label><br/><input id="emp-role" placeholder="Cargo" /></div>
            <div><label>Sal√°rio Base</label><br/><input id="emp-salary" type="number" step="0.01" placeholder="0,00" /></div>
            <button class="theme-toggle" onclick="addEmployee()">Adicionar</button>
            <button class="theme-toggle" onclick="loadEmployees()">Atualizar</button>
          </div>
          <div class="card">
            <h3>Funcion√°rios</h3>
            <table class="table" id="employees-table">
              <thead><tr><th>ID</th><th>Nome</th><th>Cargo</th><th>Sal√°rio</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <!-- Vales -->
          <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end;">
            <div><label>Funcion√°rio</label><br/><select id="allowance-emp"></select></div>
            <div><label>Data</label><br/><input id="allowance-date" type="date" /></div>
            <div><label>Valor</label><br/><input id="allowance-value" type="number" step="0.01" placeholder="0,00" /></div>
            <div><label>Descri√ß√£o</label><br/><input id="allowance-desc" placeholder="Motivo do vale" /></div>
            <button class="theme-toggle" onclick="addAllowance()">Lan√ßar Vale</button>
            <button class="theme-toggle" onclick="loadAllowances()">Atualizar</button>
          </div>
          <div class="card">
            <h3>Vales</h3>
            <table class="table" id="allowances-table">
              <thead><tr><th>Funcion√°rio</th><th>Data</th><th>Valor</th><th>Descri√ß√£o</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- METAS -->
      <section id="section-goals" style="display:none;">
        <h2>Metas</h2>
        <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end;">
          <select id="goal-meter"></select>
          <input type="number" id="goal-daily" placeholder="Meta di√°ria" min="0" step="0.01"/>
          <input type="number" id="goal-warn" placeholder="% aviso (ex: 90)" min="1" max="99"/>
          <button class="theme-toggle" onclick="saveGoal()">Salvar</button>
          <button class="theme-toggle" onclick="deleteGoal()">Remover</button>
        </div>
        <div class="card"><ul id="alerts" class="alert-list" style="display:grid;gap:8px;"></ul></div>
      </section>

      <!-- RELAT√ìRIOS -->
      <section id="section-reports" style="display:none;">
        <h2>Relat√≥rios</h2>
        <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end;">
          <select id="report-range">
            <option value="7">√öltimos 7 dias</option>
            <option value="30">√öltimos 30 dias</option>
            <option value="90">√öltimos 90 dias</option>
          </select>
          <button class="theme-toggle" onclick="generateReport()">Gerar Tabela</button>
          <button class="theme-toggle" onclick="exportToExcel()">üì¶ Excel</button>
          <button class="theme-toggle" onclick="exportPDF()">üßæ PDF</button>
        </div>
        <div class="card">
          <table class="table" id="report-table">
            <thead><tr><th>Dia</th><th>Tipo</th><th>Total</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- USU√ÅRIOS -->
      <section id="section-users" style="display:none;">
        <h2>Usu√°rios</h2>
        <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end;">
          <input id="userCreate-name" placeholder="Nome" />
          <input id="userCreate-email" placeholder="E-mail" />
          <input id="userCreate-password" placeholder="Senha" />
          <select id="userCreate-role"><option value="user">Usu√°rio</option><option value="admin">Admin</option></select>
          <button class="theme-toggle" onclick="createUser()">Adicionar</button>
          <button class="theme-toggle" onclick="loadUsers()">Atualizar</button>
        </div>
        <div class="card">
          <table class="table" id="users-table">
            <thead><tr><th>ID</th><th>Nome</th><th>E-mail</th><th>Fun√ß√£o</th><th>Criado</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- HIST√ìRICO -->
      <section id="section-history" style="display:none;">
        <h2>Hist√≥rico (Backups de Reset)</h2>
        <div class="card" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end;">
          <div><label>Medidor</label><br/>
            <select id="history-meter">
              <option value="">Todos</option>
            </select>
          </div>
          <div><label>Ciclo (etiqueta)</label><br/><input id="history-cycle" placeholder="Ex.: Kitnet 01 ‚Äî Jo√£o, nov/2025" /></div>
          <div><label>De</label><br/><input type="date" id="history-from" /></div>
          <div><label>At√©</label><br/><input type="date" id="history-to" /></div>
          <button class="theme-toggle" onclick="loadBackups()">Filtrar</button>
        </div>

        <div class="card">
          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
            <button class="theme-toggle" onclick="restoreSelected(false)">‚¨ÖÔ∏è Restaurar selecionados</button>
            <button class="theme-toggle" onclick="restoreSelected(true)">‚¨ÖÔ∏è Restaurar & Remover do backup</button>
            <span style="opacity:.8;">ou por ciclo:</span>
            <input id="history-cycle" placeholder="Ciclo exato para restore" style="min-width:260px;" />
            <input id="history-meter-aux" style="display:none;" />
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" id="history-purge" /> Remover do backup ap√≥s restaurar
            </label>
            <button class="theme-toggle" onclick="restoreByCycle()">Restaurar por Ciclo</button>
          </div>
        </div>

        <div class="card">
          <table class="table" id="history-table">
            <thead>
              <tr>
                <th></th>
                <th>ID</th>
                <th>Ciclo</th>
                <th>Medidor</th>
                <th>Tipo</th>
                <th>Valor</th>
                <th>Backup em</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
